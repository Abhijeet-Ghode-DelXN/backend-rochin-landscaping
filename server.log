[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: js,mjs,cjs,json[39m
[32m[nodemon] starting `node server.js`[39m
(node:1764) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(Use `node --trace-warnings ...` to show where the warning was created)
(node:1764) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
Server running in production mode on port 5000
MongoDB Connected: ac-q0etrwr-shard-00-01.sfnbxic.mongodb.net
Auth Headers: No authorization header
No token found
--- GLOBAL ERROR HANDLER ---
ErrorResponse: Not authorized to access this route
    at D:\Multi-tenant (Gardening)\Website\New folder\src\middlewares\auth.js:28:17
    at D:\Multi-tenant (Gardening)\Website\New folder\src\middlewares\async.js:3:5
    at Layer.handle [as handle_request] (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\layer.js:95:5)
    at next (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\route.js:149:13)
    at Route.dispatch (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\route.js:119:3)
    at Layer.handle [as handle_request] (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\layer.js:95:5)
    at D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:284:15
    at Function.process_params (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:346:12)
    at next (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:280:10)
    at Function.handle (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:175:3) {
  statusCode: 401
}
--- END GLOBAL ERROR HANDLER ---
Auth Headers: No authorization header
No token found
--- GLOBAL ERROR HANDLER ---
ErrorResponse: Not authorized to access this route
    at D:\Multi-tenant (Gardening)\Website\New folder\src\middlewares\auth.js:28:17
    at D:\Multi-tenant (Gardening)\Website\New folder\src\middlewares\async.js:3:5
    at Layer.handle [as handle_request] (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\layer.js:95:5)
    at next (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\route.js:149:13)
    at Route.dispatch (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\route.js:119:3)
    at Layer.handle [as handle_request] (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\layer.js:95:5)
    at D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:284:15
    at Function.process_params (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:346:12)
    at next (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:280:10)
    at Function.handle (D:\Multi-tenant (Gardening)\Website\New folder\node_modules\express\lib\router\index.js:175:3) {
  statusCode: 401
}
--- END GLOBAL ERROR HANDLER ---
No token found, continuing as unauthenticated
No token found, continuing as unauthenticated
No token found, continuing as unauthenticated
No token found, continuing as unauthenticated
No token found, continuing as unauthenticated
No token found, continuing as unauthenticated
âœ… Using real Gmail email configuration
ðŸ“§ Message sent: <22e0ecc3-8c68-b99a-e47a-4e296d78b5b5@gmail.com>
Creating customer with tenantId: new ObjectId('68591596ab1b5cb6d720b33e')
Auth Headers: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Token from Authorization header: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Verifying token with secret: Secret exists
Decoded token: {
  id: '685d3cbfd19c233f33ea8933',
  role: 'customer',
  tenantId: {
    settings: { timezone: 'UTC', themeColor: '#10B981' },
    subscription: {
      plan: 'annual',
      status: 'active',
      startDate: '2025-06-23T00:00:00.000Z',
      endDate: '2026-06-22T00:00:00.000Z'
    },
    _id: '68591596ab1b5cb6d720b33e',
    name: 'DemoGardning',
    subdomain: 'demogardning',
    owner: '68591597ab1b5cb6d720b341',
    createdAt: '2025-06-23T08:51:35.000Z',
    __v: 0
  },
  iat: 1750940949,
  exp: 1753532949
}
Found user: Yes
User role: customer
Token role: customer
Appointments Route - Headers: {
  host: 'localhost:5000',
  connection: 'keep-alive',
  'sec-ch-ua-platform': '"Windows"',
  authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew',
  'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36',
  accept: 'application/json, text/plain, */*',
  'sec-ch-ua': '"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',
  'sec-ch-ua-mobile': '?0',
  origin: 'http://demogardning.localhost:3000',
  'sec-fetch-site': 'cross-site',
  'sec-fetch-mode': 'cors',
  'sec-fetch-dest': 'empty',
  referer: 'http://demogardning.localhost:3000/',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'en-US,en;q=0.9,hi;q=0.8',
  'if-none-match': 'W/"24-YA2qaqoHN76SgtFfK4UBGqyVP1w"'
}
Appointments Route - Method: GET
Appointments Route - Path: /my-appointments
Auth Headers: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Token from Authorization header: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Verifying token with secret: Secret exists
Decoded token: {
  id: '685d3cbfd19c233f33ea8933',
  role: 'customer',
  tenantId: {
    settings: { timezone: 'UTC', themeColor: '#10B981' },
    subscription: {
      plan: 'annual',
      status: 'active',
      startDate: '2025-06-23T00:00:00.000Z',
      endDate: '2026-06-22T00:00:00.000Z'
    },
    _id: '68591596ab1b5cb6d720b33e',
    name: 'DemoGardning',
    subdomain: 'demogardning',
    owner: '68591597ab1b5cb6d720b341',
    createdAt: '2025-06-23T08:51:35.000Z',
    __v: 0
  },
  iat: 1750940949,
  exp: 1753532949
}
Found user: Yes
User role: customer
Token role: customer
Checking role authorization: { userRole: 'customer', allowedRoles: [ 'customer' ] }
Appointments Route - Headers: {
  host: 'localhost:5000',
  connection: 'keep-alive',
  'sec-ch-ua-platform': '"Windows"',
  authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew',
  'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36',
  accept: 'application/json, text/plain, */*',
  'sec-ch-ua': '"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',
  'sec-ch-ua-mobile': '?0',
  origin: 'http://demogardning.localhost:3000',
  'sec-fetch-site': 'cross-site',
  'sec-fetch-mode': 'cors',
  'sec-fetch-dest': 'empty',
  referer: 'http://demogardning.localhost:3000/',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'en-US,en;q=0.9,hi;q=0.8',
  'if-none-match': 'W/"24-YA2qaqoHN76SgtFfK4UBGqyVP1w"'
}
Appointments Route - Method: GET
Appointments Route - Path: /my-appointments
Auth Headers: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Token from Authorization header: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NWQzY2JmZDE5YzIzM2YzM2VhODkzMyIsInJvbGUiOiJjdXN0b21lciIsInRlbmFudElkIjp7InNldHRpbmdzIjp7InRpbWV6b25lIjoiVVRDIiwidGhlbWVDb2xvciI6IiMxMEI5ODEifSwic3Vic2NyaXB0aW9uIjp7InBsYW4iOiJhbm51YWwiLCJzdGF0dXMiOiJhY3RpdmUiLCJzdGFydERhdGUiOiIyMDI1LTA2LTIzVDAwOjAwOjAwLjAwMFoiLCJlbmREYXRlIjoiMjAyNi0wNi0yMlQwMDowMDowMC4wMDBaIn0sIl9pZCI6IjY4NTkxNTk2YWIxYjVjYjZkNzIwYjMzZSIsIm5hbWUiOiJEZW1vR2FyZG5pbmciLCJzdWJkb21haW4iOiJkZW1vZ2FyZG5pbmciLCJvd25lciI6IjY4NTkxNTk3YWIxYjVjYjZkNzIwYjM0MSIsImNyZWF0ZWRBdCI6IjIwMjUtMDYtMjNUMDg6NTE6MzUuMDAwWiIsIl9fdiI6MH0sImlhdCI6MTc1MDk0MDk0OSwiZXhwIjoxNzUzNTMyOTQ5fQ.K3d9DQSm5FQu8l9IGI04n0IRzUZAqQZ6ki0mQoqOMew
Verifying token with secret: Secret exists
Decoded token: {
  id: '685d3cbfd19c233f33ea8933',
  role: 'customer',
  tenantId: {
    settings: { timezone: 'UTC', themeColor: '#10B981' },
    subscription: {
      plan: 'annual',
      status: 'active',
      startDate: '2025-06-23T00:00:00.000Z',
      endDate: '2026-06-22T00:00:00.000Z'
    },
    _id: '68591596ab1b5cb6d720b33e',
    name: 'DemoGardning',
    subdomain: 'demogardning',
    owner: '68591597ab1b5cb6d720b341',
    createdAt: '2025-06-23T08:51:35.000Z',
    __v: 0
  },
  iat: 1750940949,
  exp: 1753532949
}
Found user: Yes
User role: customer
Token role: customer
Checking role authorization: { userRole: 'customer', allowedRoles: [ 'customer' ] }
âœ… Using real Gmail email configuration
ðŸ“§ Message sent: <5f965921-3900-c3ed-b201-b8d20492eb98@gmail.com>
